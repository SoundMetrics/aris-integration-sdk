<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:fire="http://schemas.microsoft.com/wix/FirewallExtension">

  <!-- This include file is generated by generate-wix-include-for-version.fsx -->
  <?include apps_version.wxi?>

  <Product Id="{6F42B2D3-53FE-4A5C-8912-32D8E40B6610}"
           Name="ARIS Log"
           Language="1033"
           Version="$(var.APPS_VERSION)"
           Manufacturer="Sound Metrics Corporation"
           UpgradeCode="{F29939F4-5694-4429-86E4-F5BAB0001C8D}">

    <Package InstallerVersion="405"
         Compressed="yes"
         InstallPrivileges="elevated"
         InstallScope="perMachine" />

    <?define AppRoot = "../arislog"?>

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <!--
      Definitions for OS versions are here: http://msdn.microsoft.com/library/aa370556.aspx
      Other properties can be found here: http://msdn.microsoft.com/en-us/library/aa370905(v=vs.85)
    -->
    <Condition Message='This software requires Windows 7 or later.'>VersionNT >= 601</Condition>

    <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

    <!-- Makes the icon available for use in the add/remove control panel -->
    <!--<Icon Id="logo.ico" SourceFile="$(var.AppRoot)/ARIS_Update_main_icon.ico"/>-->
    <!--<Property Id="ARPPRODUCTICON" Value="logo.ico" />-->

    <!-- Variables are defined in each .wxs file that needs them -->

    <?define bin = "$(var.ProjectDir)../$(var.Configuration)"?>

    <?define mfrfolder = "Sound Metrics"?>
    <?define installfolder = "ARIS Log"?>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="ManufacturerDir" Name="$(var.mfrfolder)">
          <Directory Id="INSTALLLOCATION" Name="$(var.installfolder)">
            <Component Id="MainProgram" Guid="{CA4D26E8-BF60-4269-B193-2A65C907D771}">
              <File Id="ARISLOGEXE" Name="arislog.exe" Source="$(var.bin)/arislog.exe" KeyPath="yes">
                <Shortcut Id="startMenuShortcut" Directory="ProgramMenuDir" Name="ARIS Log" Advertise="yes"/>

                <Shortcut Id="desktopShortcut"
                          Directory="DesktopFolder"
                          Name="$(var.installfolder)"
                          Advertise="yes"/>
                <fire:FirewallException Id="arislog.FirewallException"
                                        Name="arislog.exe firewall exception"
                                        Description="Allows ARIS Log to interact with equipment"
                                        Scope="any"
                                        />

              </File>
            </Component>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="CompanyMenuDir" Name="$(var.mfrfolder)">
          <Directory Id="ProgramMenuDir" Name="ARIS Log">
            <Component Id="ProgramMenuDir" Guid="{8868709D-0329-4295-B8C1-A122A60875B0}">
              <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
              <RemoveFolder Id='CompanyMenuDir' On='uninstall' Directory='CompanyMenuDir'/>
              <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
            </Component>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="DesktopFolder" Name="Desktop" />

    </Directory>

    <!-- Main product feature -->

    <Feature Id="ProductFeature" Title="ArisLogSetup" Level="1" ConfigurableDirectory='INSTALLLOCATION'>
      <ComponentRef Id="MainProgram" />
      <ComponentRef Id="ProgramMenuDir" />
    </Feature>

  </Product>
</Wix>
